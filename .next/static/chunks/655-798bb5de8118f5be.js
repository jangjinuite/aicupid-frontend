"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[655],{1655:function(e,t,n){n.d(t,{T:function(){return R}});var a,s=n(7437),r=n(2265),i=n(9596),l=n(7586),c=n(9376),o=n(2521),d=n(6410),u=n(9800);let x=(null!==(a=n(257).env.NEXT_PUBLIC_BACKEND_URL)&&void 0!==a?a:"http://localhost:8000").replace(/^http/,"ws")+"/ws";var p=n(2893);let m=[[.08,1,.25,.75,.12,.9,.3],[.3,.55,.95,.2,.8,.35,.7],[.5,.15,.85,.4,.95,.25,.6],[.15,.7,.3,1,.4,.8,.18],[.6,.2,.9,.35,.7,.15,.85],[.25,.9,.45,.7,.2,.95,.4],[.8,.3,.6,.15,.85,.3,.65],[.1,.75,.4,.9,.25,.7,.1]],f=[48,44,38,32,26,20,14,10];function h(e){let{status:t,side:n,count:a=8}=e,r="speaking"===t,l="listening"===t,c=f.slice(0,a),o="left"===n?[...c].reverse():c;return(0,s.jsx)("div",{className:"flex items-center gap-[3px]",style:{flexDirection:"left"===n?"row-reverse":"row"},children:o.map((e,t)=>{let c=m[t%m.length],o="left"===n?a-1-t:t,d=.055*o;return(0,s.jsx)(i.E.div,{className:"rounded-full",style:{width:3,backgroundColor:"#86E3E3",transformOrigin:"center"},animate:r?{height:c.map(t=>Math.max(4,e*t)),opacity:.9,transition:{duration:.65+.04*o,repeat:1/0,ease:"easeInOut",delay:d}}:l?{height:[4,.12*e,4],opacity:.45,transition:{duration:1.8,repeat:1/0,ease:"easeInOut",delay:.5*d}}:{height:3,opacity:.18,transition:{duration:.3}}},t)})})}let g={idle:"rgba(134,227,227,0.15)",listening:"rgba(134,227,227,0.5)",speaking:"rgba(134,227,227,0.9)",thinking:"rgba(230,208,142,0.6)"},b="clamp(150px, 46vw, 210px)";function y(e){let{avatarState:t,voiceStatus:n,persona:a}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-[clamp(0.5rem,2vw,1rem)]",children:[(0,s.jsx)(h,{status:n,side:"left",count:7}),(0,s.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,s.jsx)(i.E.div,{className:"absolute",style:{inset:-10,borderRadius:"50%",border:"2.5px solid ".concat(g[t])},variants:p.id,animate:t}),(0,s.jsx)(i.E.div,{layoutId:"avatar",style:{width:b,height:b,border:"3px solid #86E3E3",background:"#F0FAFA",borderRadius:"50%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:a.image?(0,s.jsx)("img",{src:a.image,alt:a.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,s.jsx)("span",{className:"select-none",style:{fontSize:"clamp(3rem, 12vw, 4.5rem)"},children:a.emoji})})]}),(0,s.jsx)(h,{status:n,side:"right",count:7})]}),(0,s.jsx)("p",{className:"font-bold text-[clamp(1rem,4vw,1.25rem)] text-[#1A1A1A] dark:text-[#F0F0F0] tracking-tight",children:a.name})]})}let A={idle:{label:"마이크 꺼짐",dot:"#9CA3AF",bar:"#9CA3AF"},listening:{label:"듣는 중",dot:"#86E3E3",bar:"#86E3E3"},speaking:{label:"녹음 중",dot:"#FAA2EE",bar:"#FAA2EE"},ai_speaking:{label:"AI 응답 중",dot:"#E6D08E",bar:"#E6D08E"},waiting:{label:"처리 중...",dot:"#E6D08E",bar:"#E6D08E"}},v=[[.2,1,.4,.8,.15],[.5,.2,.9,.3,.7],[.3,.8,.15,.95,.4],[.7,.3,.6,.1,.8],[.1,.7,.5,.9,.2],[.6,.15,.85,.4,.65],[.25,.9,.35,.7,.1]];function E(e){let{status:t,wsConnected:n}=e,a=A[t],r="speaking"===t||"listening"===t;return(0,s.jsxs)("div",{className:"w-full px-5 py-3 rounded-2xl bg-surface dark:bg-dark-card flex items-center gap-3 border border-[#86E3E3]/20",children:[(0,s.jsx)("div",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:{backgroundColor:a.dot,boxShadow:r?"0 0 8px ".concat(a.dot):"none"}}),(0,s.jsx)("span",{className:"text-sm font-semibold text-[#1A1A1A] dark:text-[#F0F0F0] flex-shrink-0",children:a.label}),(0,s.jsx)("div",{className:"flex-1 flex items-center justify-end gap-[3px] h-6",children:v.map((e,n)=>(0,s.jsx)(i.E.div,{className:"rounded-full",style:{width:3,backgroundColor:a.bar},animate:r?{height:e.map(e=>Math.max(3,24*e)),opacity:.85,transition:{duration:"speaking"===t?.55:1.2,repeat:1/0,ease:"easeInOut",delay:.07*n}}:{height:3,opacity:.3,transition:{duration:.3}}},n))}),(0,s.jsx)("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:n?"#86E3E3":"#9CA3AF",opacity:n?1:.4}})]})}var w=n(4986);function j(e){let{question:t,participantCount:n=2,participants:a,voiceStatus:c,wsConnected:o,onClose:d}=e,[u,x]=(0,r.useState)(0),m=null!=a?a:Array.from({length:n},(e,t)=>"참가자 ".concat(t+1)),f=u===n-1;return(0,s.jsxs)(i.E.div,{className:"relative w-full popup-sheet rounded-[2rem] overflow-hidden z-30",style:{maxHeight:"85dvh",overflowY:"auto"},variants:p.z6,initial:"hidden",animate:"visible",exit:"exit",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 pt-5 pb-3",children:[(0,s.jsx)("span",{className:"text-xs font-bold tracking-widest uppercase text-primary",children:"심리 테스트"}),(0,s.jsx)("button",{onClick:d,className:"w-8 h-8 rounded-full bg-black/5 dark:bg-white/10 flex items-center justify-center",children:(0,s.jsx)(w.Z,{className:"w-4 h-4 text-[#1A1A1A] dark:text-[#F0F0F0]"})})]}),(0,s.jsx)("p",{className:"px-6 text-base font-medium text-[#1A1A1A] dark:text-[#F0F0F0] leading-relaxed text-balance",children:t}),(0,s.jsxs)("div",{className:"px-6 pt-4 pb-2",children:[(0,s.jsx)("div",{className:"flex gap-2 mb-3",children:m.map((e,t)=>(0,s.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-300",style:{flex:t===u?2:1,backgroundColor:t<=u?"#86E3E3":"#E5E7EB"}},t))}),(0,s.jsx)(l.M,{mode:"wait",children:(0,s.jsxs)(i.E.div,{initial:{opacity:0,x:16},animate:{opacity:1,x:0},exit:{opacity:0,x:-16},transition:{duration:.2},className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-white",style:{backgroundColor:"#86E3E3"},children:u+1}),(0,s.jsxs)("span",{className:"font-semibold text-[#1A1A1A] dark:text-[#F0F0F0]",children:[m[u]," 답변 중"]})]},u)})]}),(0,s.jsx)("div",{className:"px-6 py-3",children:(0,s.jsx)(E,{status:c,wsConnected:o})}),(0,s.jsx)("div",{className:"px-6 pb-6 pt-1",children:(0,s.jsx)("button",{onClick:()=>{f?d():x(e=>e+1)},className:"w-full py-3.5 rounded-2xl font-bold text-base text-white transition-transform active:scale-[0.97]",style:{backgroundColor:"#86E3E3",color:"#0A4040"},children:f?"완료":"다음 →"})})]})}function k(e){let{question:t,choices:n,voiceStatus:a,wsConnected:r,onClose:l}=e;return(0,s.jsxs)(i.E.div,{className:"relative w-full popup-sheet rounded-[2rem] overflow-hidden z-30",variants:p.z6,initial:"hidden",animate:"visible",exit:"exit",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 pt-5 pb-3",children:[(0,s.jsx)("span",{className:"text-xs font-bold tracking-widest uppercase text-gold",children:"밸런스 게임"}),(0,s.jsx)("button",{onClick:l,className:"w-8 h-8 rounded-full bg-black/5 dark:bg-white/10 flex items-center justify-center",children:(0,s.jsx)(w.Z,{className:"w-4 h-4 text-[#1A1A1A] dark:text-[#F0F0F0]"})})]}),(0,s.jsx)("p",{className:"px-6 pb-4 text-base font-semibold text-[#1A1A1A] dark:text-[#F0F0F0] leading-relaxed text-balance",children:t}),(0,s.jsxs)("div",{className:"px-6 pb-4 grid grid-cols-2 gap-3",children:[(0,s.jsx)(i.E.div,{className:"rounded-2xl flex items-center justify-center py-10 px-3 text-center cursor-default",style:{backgroundColor:"#86E3E3"},whileTap:{scale:.97},children:(0,s.jsx)("span",{className:"font-black text-xl leading-tight text-[#0A4040]",children:n[0]})}),(0,s.jsx)(i.E.div,{className:"rounded-2xl flex items-center justify-center py-10 px-3 text-center cursor-default",style:{backgroundColor:"#FAA2EE"},whileTap:{scale:.97},children:(0,s.jsx)("span",{className:"font-black text-xl leading-tight text-[#4A0A40]",children:n[1]})})]}),(0,s.jsx)("p",{className:"px-6 pb-2 text-xs text-[#1A1A1A]/40 dark:text-white/30 text-center",children:"음성으로 답변해 주세요"}),(0,s.jsx)("div",{className:"px-6 pb-6",children:(0,s.jsx)(E,{status:a,wsConnected:r})})]})}let N=[{bg:"#B8F0F0",text:"#0A4040",label:"A"},{bg:"#F5E9BB",text:"#4A3800",label:"B"},{bg:"#FDCFF7",text:"#4A0A40",label:"C"},{bg:"#E8E8F0",text:"#1A1A2A",label:"D"}];function C(e){let{question:t,choices:n,voiceStatus:a,wsConnected:r,onClose:l}=e,c=n.slice(0,4);return(0,s.jsxs)(i.E.div,{className:"relative w-full popup-sheet rounded-[2rem] overflow-hidden z-30",variants:p.z6,initial:"hidden",animate:"visible",exit:"exit",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 pt-5 pb-3",children:[(0,s.jsx)("span",{className:"text-xs font-bold tracking-widest uppercase",style:{color:"#E6D08E"},children:"퀴즈"}),(0,s.jsx)("button",{onClick:l,className:"w-8 h-8 rounded-full bg-black/5 dark:bg-white/10 flex items-center justify-center",children:(0,s.jsx)(w.Z,{className:"w-4 h-4 text-[#1A1A1A] dark:text-[#F0F0F0]"})})]}),(0,s.jsx)("p",{className:"px-6 pb-4 text-base font-semibold text-[#1A1A1A] dark:text-[#F0F0F0] leading-relaxed text-balance",children:t}),(0,s.jsx)("div",{className:"px-6 pb-4 grid grid-cols-2 gap-3",children:c.map((e,t)=>{var n;let a=null!==(n=N[t])&&void 0!==n?n:N[3];return(0,s.jsxs)(i.E.div,{className:"rounded-2xl p-4 flex flex-col gap-1 cursor-default",style:{backgroundColor:a.bg},whileTap:{scale:.97},children:[(0,s.jsx)("span",{className:"text-xs font-black",style:{color:a.text,opacity:.5},children:a.label}),(0,s.jsx)("span",{className:"font-bold text-sm leading-snug",style:{color:a.text},children:e})]},t)})}),(0,s.jsx)("p",{className:"px-6 pb-2 text-xs text-[#1A1A1A]/40 dark:text-white/30 text-center",children:"A, B, C, D 중 음성으로 답변해 주세요"}),(0,s.jsx)("div",{className:"px-6 pb-6",children:(0,s.jsx)(E,{status:a,wsConnected:r})})]})}var S=n(8078),F=n(1930);let D={idle:{label:"● 대기",bg:"#F0F0F0",text:"#9CA3AF"},listening:{label:"◉ 듣는 중",bg:"#B8F0F0",text:"#0A4040"},speaking:{label:"\uD83C\uDF99 녹음 중",bg:"#FDCFF7",text:"#4A0A40"},ai_speaking:{label:"\uD83D\uDD0A AI 응답",bg:"#F5E9BB",text:"#4A3800"},waiting:{label:"⏳ 처리 중",bg:"#F5E9BB",text:"#4A3800"}},I={1:{type:"psych",question:"당신은 지금 깊은 숲속을 걷고 있습니다. 곁에는 원숭이, 사자, 말, 소, 양 이렇게 다섯 마리의 동물이 함께 있어요. 길을 가다 보니 너무 힘들어서 한 마리씩 버리고 가야 합니다. 어떤 순서로 버리시겠어요?",choices:[]},2:{type:"balance",question:"평생 한 종류의 음식만 먹어야 한다면? 단짠(달고 짠 음식) vs 매콤(매운 음식)",choices:["단짠","매콤"]},3:{type:"quiz",question:"다음 중 사랑의 신 큐피드의 무기는 무엇일까요?",choices:["활과 화살","마법 지팡이","황금 방패","수정 구슬"]}};function R(){var e,t,n,a;let m=(0,c.useRouter)(),{state:f,dispatch:h}=(0,d.b)(),{status:g,wsStatus:b,isWaiting:A,avatarState:v,loading:w,error:N,gameEvent:R,start:T,stop:_,forceCommit:O,dismissEvent:P}=function(){let[e,t]=(0,r.useState)("idle"),[n,a]=(0,r.useState)("disconnected"),[s,i]=(0,r.useState)(!0),[l,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(null),[p,m]=(0,r.useState)([]),f=(0,r.useRef)(crypto.randomUUID()),h=(0,r.useRef)(null),g=(0,r.useRef)(null),b=(0,r.useRef)(null),y=(0,r.useRef)(null),A=(0,r.useRef)(null),v=(0,r.useRef)(!1),E=(0,r.useRef)(16e3),w=(0,r.useRef)(!1),j=(0,r.useRef)(0),{playResponse:k,close:N}=function(){let e=(0,r.useRef)(null),t=(0,r.useRef)(0),n=(0,r.useRef)(null),a=(0,r.useCallback)((n,a)=>{if(!n)return;let s=a.match(/rate=(\d+)/),r=s?parseInt(s[1],10):24e3;e.current&&"closed"!==e.current.state||(e.current=new AudioContext({sampleRate:r}),t.current=0);let i=e.current,l=atob(n),c=new Uint8Array(l.length);for(let e=0;e<l.length;e++)c[e]=l.charCodeAt(e);let o=Math.floor(c.length/2),d=new Float32Array(o),u=new DataView(c.buffer);for(let e=0;e<o;e++)d[e]=u.getInt16(2*e,!0)/32768;let x=i.createBuffer(1,o,r);x.copyToChannel(d,0);let p=i.createBufferSource();p.buffer=x,p.connect(i.destination);let m=Math.max(i.currentTime,t.current);p.start(m),t.current=m+x.duration},[]);return{playResponse:(0,r.useCallback)(async(s,r)=>{if(!s)return;let i=atob(s),l=new Uint8Array(i.length);for(let e=0;e<i.length;e++)l[e]=i.charCodeAt(e);if("audio/mpeg"===r||"audio/mp3"===r){let e=new Blob([l],{type:r}),t=URL.createObjectURL(e);n.current||(n.current=new Audio),n.current.src=t,n.current.onended=()=>URL.revokeObjectURL(t),await n.current.play().catch(e=>console.error("[AudioQueue] mp3 play failed:",e));return}e.current&&"closed"!==e.current.state||(e.current=new AudioContext,t.current=0);let c=e.current;try{let e=await c.decodeAudioData(l.buffer.slice(0)),n=c.createBufferSource();n.buffer=e,n.connect(c.destination);let a=Math.max(c.currentTime,t.current);n.start(a),t.current=a+e.duration}catch(e){a(s,r)}},[a]),enqueueRaw:a,flush:(0,r.useCallback)(()=>{t.current=0},[]),close:(0,r.useCallback)(()=>{var a;null===(a=e.current)||void 0===a||a.close(),e.current=null,t.current=0,n.current&&(n.current.pause(),n.current.src="")},[])}}(),C=(()=>{switch(e){case"listening":case"speaking":return"listening";case"ai_speaking":return"speaking";case"waiting":return"thinking";default:return"idle"}})(),S=(0,r.useCallback)((e,t)=>{let n={ts:function(){let e=new Date;return"".concat(String(e.getHours()).padStart(2,"0"),":").concat(String(e.getMinutes()).padStart(2,"0"),":").concat(String(e.getSeconds()).padStart(2,"0"),".").concat(String(e.getMilliseconds()).padStart(3,"0"))}(),label:e,color:t};console.log("[Debug] ".concat(n.ts," ").concat(e)),m(e=>[n,...e].slice(0,40))},[]),F=(0,r.useCallback)(()=>{var e;if((null===(e=g.current)||void 0===e?void 0:e.readyState)===WebSocket.OPEN)return;a("connecting"),S("WS 연결 시도...","yellow");let n=new WebSocket("".concat(x,"?session_id=").concat(f.current));n.binaryType="arraybuffer",g.current=n,n.onopen=()=>{a("connected"),S("✓ WS 연결됨","green")},n.onerror=()=>{a("error"),S("✗ WS 에러","red")},n.onclose=e=>{a("disconnected"),S("WS 종료 (code=".concat(e.code,")"),"yellow"),g.current=null},n.onmessage=async e=>{let n;if("string"==typeof e.data){try{n=JSON.parse(e.data)}catch(e){return}if("audio"===n.type&&n.data){var a;let e=Math.round(3*n.data.length/4/1024);S("◀ 오디오 수신 ".concat(e,"KB (").concat(n.mime_type,")"),"blue"),t("ai_speaking"),await k(n.data,null!==(a=n.mime_type)&&void 0!==a?a:"audio/wav"),S("✓ 재생 완료","blue"),t(e=>"ai_speaking"===e||"waiting"===e?"listening":e)}else"event"===n.type&&n.event?(S("\uD83C\uDFAE 게임 이벤트: ".concat(n.event.type),"purple"),d(n.event)):"error"===n.type&&S("✗ 서버 오류: ".concat(n.message),"red")}}},[k,S]),D=(0,r.useCallback)(()=>{var e;null===(e=g.current)||void 0===e||e.close(1e3,"session ended"),g.current=null},[]),I=(0,r.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,echoCancellation:!0,noiseSuppression:!0}});A.current=e;let t=new AudioContext;b.current=t,E.current=t.sampleRate,S("✓ AudioContext ".concat(t.sampleRate,"Hz"),"green");let n=t.createMediaStreamSource(e),a=t.createScriptProcessor(4096,1,1);y.current=a,j.current=0,a.onaudioprocess=e=>{if(!v.current)return;let t=g.current;if(!t||t.readyState!==WebSocket.OPEN)return;let n=function(e){let t=new ArrayBuffer(2*e.length),n=new DataView(t);for(let t=0;t<e.length;t++){let a=Math.max(-1,Math.min(1,e[t]));n.setInt16(2*t,a<0?32768*a:32767*a,!0)}return t}(e.inputBuffer.getChannelData(0));t.send(n),j.current+=1},n.connect(a),a.connect(t.destination),S("✓ PCM 스트리밍 준비","green")}catch(t){let e=t instanceof Error?t.message:String(t);S("✗ 마이크 오류: ".concat(e),"red"),c(e)}},[S]),R=(0,r.useCallback)(()=>{var e,t,n;v.current=!1,null===(e=y.current)||void 0===e||e.disconnect(),y.current=null,null===(t=b.current)||void 0===t||t.close(),b.current=null,null===(n=A.current)||void 0===n||n.getTracks().forEach(e=>e.stop()),A.current=null},[]),T=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=g.current;if(!t||t.readyState!==WebSocket.OPEN){S("✗ ".concat(e?"force_commit":"speech_end",": WS 미연결"),"red");return}let n=j.current;j.current=0,S("▶ ".concat(e?"force_commit":"speech_end"," 전송 (청크 ").concat(n,"개, ").concat(E.current,"Hz)"),"green"),t.send(JSON.stringify({type:e?"force_commit":"speech_end",sample_rate:E.current}))},[S]);(0,r.useEffect)(()=>(w.current=!1,u.Nj.new({startOnLoad:!1,baseAssetPath:"/",onnxWASMBasePath:"/",onSpeechStart(){S("\uD83C\uDF99 SPEECH START — 스트리밍 시작","yellow"),v.current=!0,j.current=0,t(e=>"listening"===e?"speaking":e)},onSpeechEnd(e){v.current=!1,S("\uD83D\uDD07 SPEECH END — 스트리밍 종료","yellow"),t("listening"),T()},onVADMisfire(){v.current=!1,j.current=0,S("⚡ VAD misfire","red"),t(e=>"speaking"===e?"listening":e)}}).then(e=>{if(w.current){e.destroy();return}h.current=e,i(!1),S("✓ VAD 초기화 완료","green")}).catch(e=>{let t=e instanceof Error?e.message:String(e);S("✗ VAD 초기화 실패: ".concat(t),"red"),c(t),i(!1)}),()=>{w.current=!0,v.current=!1;let e=h.current;e&&(h.current=null,e.destroy()),R(),D(),N()}),[]);let _=(0,r.useCallback)(()=>{if(!g.current||g.current.readyState!==WebSocket.OPEN){S("✗ forceCommit: WS 미연결","red");return}S("\uD83D\uDC46 FORCE COMMIT","yellow"),v.current=!1,T(!0),t("waiting")},[S,T]);return{status:e,wsStatus:n,isWaiting:"waiting"===e,avatarState:C,loading:s,error:l,gameEvent:o,debugLog:p,start:(0,r.useCallback)(()=>{let e=h.current;e&&(F(),e.start(),I(),t("listening"),S("▶ 세션 시작","green"))},[F,I,S]),stop:(0,r.useCallback)(()=>{v.current=!1;let e=h.current;e&&e.pause(),R(),D(),N(),t("idle"),S("■ 세션 중지","yellow")},[R,D,N,S]),forceCommit:_,dismissEvent:(0,r.useCallback)(()=>d(null),[])}}(),[M,B]=(0,r.useState)(null),[U,W]=(0,r.useState)(!1);(0,r.useEffect)(()=>{w||"idle"!==g||T()},[w,g,T]),(0,r.useEffect)(()=>{let e=e=>{let t=I[e.key];t&&B(t)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let z=null!=R?R:M,L=R?P:()=>B(null),q=null!==(e=F.IJ.find(e=>e.id===f.sessionSettings.selectedPersonaId))&&void 0!==e?e:F.IJ[0],J="idle"!==g,G="connected"===b,H=null!==(t=D[g])&&void 0!==t?t:D.idle;return(0,s.jsxs)(i.E.div,{className:"absolute inset-0 flex flex-col bg-white dark:bg-dark-bg overflow-hidden mx-auto w-full z-20",style:{maxWidth:430},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25},children:[(0,s.jsxs)("div",{className:"shrink-0 flex items-center justify-between px-5 pb-3",style:{paddingTop:"max(2.5rem, env(safe-area-inset-top, 2.5rem))"},children:[(0,s.jsxs)(i.E.button,{onClick:()=>{_(),h({type:"GO_LANDING"})},className:"flex items-center gap-1 text-sm font-semibold text-primary",whileTap:{scale:.92},children:[(0,s.jsx)(o.Z,{className:"w-4 h-4"}),"뒤로"]}),(0,s.jsx)("span",{className:"font-black text-base text-[#1A1A1A] dark:text-[#F0F0F0] tracking-tight",children:"AI CUPID"}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"connected"===b?"#86E3E3":"connecting"===b?"#E6D08E":"error"===b?"#EF4444":"#9CA3AF",boxShadow:G?"0 0 6px #86E3E3":"none"}}),(0,s.jsx)("span",{className:"text-xs text-[#1A1A1A]/40 dark:text-white/30 font-mono",children:b})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center gap-4 px-4 overflow-hidden",children:[(0,s.jsx)(i.E.button,{onClick:J&&!A?O:void 0,className:J&&!A?"cursor-pointer":"cursor-default",whileTap:J&&!A?{scale:.97}:{},children:(0,s.jsx)(y,{avatarState:v,voiceStatus:g,persona:q})}),(0,s.jsx)(l.M,{mode:"wait",children:(0,s.jsx)(i.E.span,{initial:{opacity:0,y:-6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:.15},className:"status-pill font-bold",style:{backgroundColor:H.bg,color:H.text},children:H.label},g)}),J&&!A&&(0,s.jsx)("p",{className:"text-[11px] text-[#1A1A1A]/25 dark:text-white/20 tracking-widest uppercase",children:"탭하여 답변 전송"}),N&&(0,s.jsx)("p",{className:"text-red-500 text-xs text-center max-w-xs break-words",children:N}),(0,s.jsx)("p",{className:"text-[10px] text-[#1A1A1A]/18 dark:text-white/12 font-mono",children:"[dev] 키보드 1=심리 2=밸런스 3=퀴즈"})]}),(0,s.jsxs)("div",{className:"shrink-0 px-5 flex flex-col gap-3",style:{paddingBottom:"max(2rem, env(safe-area-inset-bottom, 2rem))"},children:[(0,s.jsx)(i.E.button,{onClick:J?()=>{W(!0)}:T,disabled:w||!!N,className:"w-full py-4 rounded-2xl font-black text-base disabled:opacity-40 disabled:cursor-not-allowed",style:{backgroundColor:J?"#FAA2EE":"#86E3E3",color:J?"#4A0A40":"#0A4040"},whileTap:{scale:.97},children:w?"로딩 중...":N?"오류":J?"중지":"시작"}),(0,s.jsx)(E,{status:g,wsConnected:G})]}),(0,s.jsxs)(l.M,{children:[z&&(0,s.jsxs)(i.E.div,{className:"absolute inset-0 z-20 flex items-center justify-center px-5",initial:"hidden",animate:"visible",exit:"exit",variants:p.Yp,children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:L}),"psych"===z.type&&(0,s.jsx)(j,{question:z.question,voiceStatus:g,wsConnected:G,onClose:L}),"balance"===z.type&&(0,s.jsx)(k,{question:z.question,choices:[null!==(n=z.choices[0])&&void 0!==n?n:"A",null!==(a=z.choices[1])&&void 0!==a?a:"B"],voiceStatus:g,wsConnected:G,onClose:L}),"quiz"===z.type&&(0,s.jsx)(C,{question:z.question,choices:z.choices,voiceStatus:g,wsConnected:G,onClose:L})]}),U&&(0,s.jsx)(S.W,{title:"AI CUPID의 현재 세션을\n종료하시겠습니까?",onConfirmText:"예",onCancelText:"아니오",onConfirm:()=>{W(!1),_(),h({type:"SET_SESSION_SUMMARY",payload:""}),m.push("/summary")},onCancel:()=>W(!1)})]})]})}},8078:function(e,t,n){n.d(t,{W:function(){return r}});var a=n(7437),s=n(9596);function r(e){let{title:t,onConfirmText:n,onCancelText:r,onConfirm:i,onCancel:l}=e;return(0,a.jsxs)("div",{className:"absolute inset-0 z-50 flex items-center justify-center px-6",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:l}),(0,a.jsxs)(s.E.div,{initial:{opacity:0,scale:.95,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:10},className:"relative w-full max-w-sm bg-white dark:bg-[#1A1A1A] rounded-[24px] p-6 shadow-2xl overflow-hidden",style:{border:"1.5px solid #86E3E3"},children:[(0,a.jsx)("h3",{className:"text-lg font-black text-center text-[#1A1A1A] dark:text-[#F0F0F0] leading-snug mb-6 whitespace-pre-line",children:t}),(0,a.jsxs)("div",{className:"grid gap-3 ".concat(r?"grid-cols-2":"grid-cols-1"),children:[r&&(0,a.jsx)("button",{onClick:l,className:"py-3.5 rounded-2xl font-bold text-sm",style:{backgroundColor:"transparent",color:"#86E3E3",border:"2px solid #86E3E3"},children:r}),(0,a.jsx)("button",{onClick:i,className:"py-3.5 rounded-2xl font-black text-sm",style:{backgroundColor:"#86E3E3",color:"#0A4040"},children:n})]})]})]})}},6410:function(e,t,n){n.d(t,{AppProvider:function(){return c},b:function(){return o}});var a=n(7437),s=n(2265);let r={phase:"landing",sessionSettings:{selectedPersonaId:n(1930).IJ[0].id,avatarState:"idle"},userProfile:null,matchedUser:null,sessionSummary:""};function i(e,t){switch(t.type){case"START_TRANSITION":return{...e,phase:"transitioning"};case"SESSION_READY":return{...e,phase:"session"};case"GO_LANDING":return{...e,phase:"landing",sessionSettings:{...e.sessionSettings,avatarState:"idle"}};case"SET_PERSONA":return{...e,sessionSettings:{...e.sessionSettings,selectedPersonaId:t.payload}};case"SET_AVATAR_STATE":return{...e,sessionSettings:{...e.sessionSettings,avatarState:t.payload}};case"SET_USER_PROFILE":return{...e,userProfile:t.payload};case"SET_MATCHED_USER":return{...e,matchedUser:t.payload};case"SET_SESSION_SUMMARY":return{...e,sessionSummary:t.payload};case"LOGOUT":return{...r};default:return e}}let l=(0,s.createContext)(null);function c(e){let{children:t}=e,[n,c]=(0,s.useReducer)(i,r);return(0,a.jsx)(l.Provider,{value:{state:n,dispatch:c},children:t})}function o(){let e=(0,s.useContext)(l);if(!e)throw Error("useAppContext must be used within AppProvider");return e}},2893:function(e,t,n){n.d(t,{Yp:function(){return s},dJ:function(){return i},id:function(){return a},z6:function(){return r}});let a={idle:{scale:1,opacity:0},speaking:{scale:[1,1.12,1],opacity:[.6,1,.6],transition:{duration:.9,repeat:1/0,ease:"easeInOut"}},listening:{scale:[1,1.06,1],opacity:[.3,.7,.3],transition:{duration:1.1,repeat:1/0,ease:"easeInOut"}},thinking:{scale:[1,1.04,1.08,1.04,1],opacity:[.2,.4,.2,.4,.2],transition:{duration:2.2,repeat:1/0,ease:"easeInOut"}}},s={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.18}},exit:{opacity:0,transition:{duration:.14}}},r={hidden:{scale:.88,opacity:0,y:12},visible:{scale:1,opacity:1,y:0,transition:{type:"spring",stiffness:340,damping:28}},exit:{scale:.88,opacity:0,y:12,transition:{duration:.14,ease:"easeIn"}}},i={enter:e=>({x:e>0?60:-60,opacity:0}),center:{x:0,opacity:1},exit:e=>({x:e>0?-60:60,opacity:0})}},1930:function(e,t,n){n.d(t,{IJ:function(){return s},YG:function(){return a}});let a=[{userId:"jisoo123",name:"이지수",age:24,gender:"female",mbti:"ENFP",interests:["영화","음악","여행"],bio:"안녕하세요! 영화 좋아하는 이지수입니다 :)"},{userId:"minho456",name:"박민호",age:27,gender:"male",mbti:"INTJ",interests:["독서","게임","아웃도어"],bio:"독서와 게임을 즐기는 박민호입니다."},{userId:"yuna789",name:"김유나",age:25,gender:"female",mbti:"ISFJ",interests:["요리","영화","패션"],bio:"요리하는 걸 좋아해요!"},{userId:"junho001",name:"최준호",age:26,gender:"male",mbti:"ESTP",interests:["스포츠","여행","음악"],bio:"스포츠와 여행을 즐기는 최준호입니다."},{userId:"somin002",name:"박소민",age:23,gender:"female",mbti:"INFP",interests:["독서","음악","영화"],bio:"감성적인 박소민입니다 ✨"},{userId:"taehyun003",name:"김태현",age:28,gender:"male",mbti:"ENTJ",interests:["스포츠","게임","요리"],bio:"열정적인 김태현입니다!"}],s=[{id:"daguri",name:"다구리",description:"귀여운 햄스터 외모 속에 숨겨진 뼈 때리는 팩트폭격기",accentColor:"rgba(255,160,122,0.70)",avatarGradient:"linear-gradient(135deg, #FFEFD5, #FFA07A)",emoji:"\uD83D\uDC39",image:"/assets/daguri.jpeg"},{id:"rudumi",name:"루두미",description:"차분하고 지적인 분위기를 풍기는 다정한 여우 마스터",accentColor:"rgba(135,206,250,0.65)",avatarGradient:"linear-gradient(135deg, #F0F8FF, #87CEFA)",emoji:"\uD83E\uDD8A",image:"/assets/rudumi.png"}]}}]);